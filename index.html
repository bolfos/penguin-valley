<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8">
<title>Penguin Valley</title>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

const firebaseConfig = {
 apiKey: "AIzaSyBSzq_-8WZ7xSqPqUd1nr_p4mNoHdFaZ3w",
 authDomain: "penguin-valley-9d490.firebaseapp.com",
 projectId: "penguin-valley-9d490",
 storageBucket: "penguin-valley-9d490.firebasestorage.app",
 messagingSenderId: "399240782858",
 appId: "1:399240782858:web:1d79355154b8be1ed3ebf3"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth();
const db = getFirestore();

window.login = async () => {
 try{
  await signInWithEmailAndPassword(auth,email.value,pass.value);
 }catch{
  await createUserWithEmailAndPassword(auth,email.value,pass.value);
 }
};

onAuthStateChanged(auth,async u=>{
 if(!u)return;
 loginBox.style.display="none";
 game.style.display="block";
 const ref=doc(db,"users",u.uid);
 const snap=await getDoc(ref);
 if(snap.exists()) Object.assign(state,snap.data());
 draw(); setInterval(draw,1000);
});

window.save=async()=>{
 const u=auth.currentUser;
 if(u) await setDoc(doc(db,"users",u.uid),state);
};
</script>

<style>
body{margin:0;font-family:Arial;background:#cfefff;text-align:center}
input,button{padding:8px;margin:5px}
#loginBox{margin-top:100px}
#game{display:none}

#top{display:flex;justify-content:space-around;align-items:center}

#farm{
 display:grid;
 grid-template-columns:repeat(10,70px);
 gap:6px;
 justify-content:center;
 margin:20px auto;
}

.tile{
 width:70px;height:70px;
 background-size:cover;
 border-radius:14px;
 animation:pop .2s;
}

@keyframes pop{from{transform:scale(.8);opacity:0}to{transform:scale(1);opacity:1}}

.free{background-image:url("assets/tiles/grass.png")}
.locked{background-image:url("assets/tiles/ice.png")}
.carrot{background-image:url("assets/tiles/carrot.png")}
.cabbage{background-image:url("assets/tiles/cabbage.png")}
.flower{background-image:url("assets/tiles/flower.png")}

#npcBox,#buildingBox{
 background:white;
 width:320px;
 margin:15px auto;
 padding:10px;
 border-radius:12px;
 box-shadow:0 4px 10px rgba(0,0,0,.2)
}

.building{
 width:100px;
 cursor:pointer;
 margin:5px;
}
</style>
</head>

<body>

<div id="loginBox">
 <h2>ğŸ§ Penguin Valley</h2>
 <input id="email" placeholder="email">
 <input id="pass" type="password">
 <br>
 <button onclick="login()">IntrÄƒ / CreeazÄƒ cont</button>
</div>

<div id="game">
 <div id="top">
  <div id="money">ğŸ’°</div>
  <div>
   <button onclick="sel('carrot')">ğŸ¥•</button>
   <button onclick="sel('cabbage')">ğŸ¥¬</button>
   <button onclick="sel('flower')">ğŸŒ¼</button>
  </div>
 </div>

 <img src="assets/penguin.png" width="80">

 <!-- CLÄ‚DIRI -->
 <div id="buildingBox">
  <b>ğŸ—ï¸ ClÄƒdiri</b><br>
  <img src="assets/buildings/market.png" class="building" onclick="openMarket()">
  <img src="assets/buildings/storage.png" class="building" onclick="openStorage()">
  <img src="assets/buildings/house.png" class="building" onclick="openHouse()">
  <div id="buildingInfo"></div>
 </div>

 <!-- NPC -->
 <div id="npcBox">
  <b id="missionText"></b><br>
  <button onclick="claimMission()">FinalizeazÄƒ misiunea</button>
 </div>

 <div id="farm"></div>
</div>

<script>
const crops={
 carrot:{t:60000,c:1,p:5},
 cabbage:{t:180000,c:3,p:15},
 flower:{t:360000,c:5,p:40}
};

const missions=[
 {text:"PlanteazÄƒ 3 morcovi",check:()=>count("carrot")>=3,reward:10},
 {text:"CÃ¢È™tigÄƒ 30 monede",check:()=>state.money>=30,reward:20}
];

let state={
 money:10,
 tiles:{},
 unlocked:20,
 sel:"carrot",
 mission:0,
 storage:0
};

const farm=document.getElementById("farm");
const money=document.getElementById("money");
const missionText=document.getElementById("missionText");
const info=document.getElementById("buildingInfo");

function sel(t){state.sel=t}

function count(t){return Object.values(state.tiles).filter(x=>x.t===t).length}

function plant(i){
 const c=crops[state.sel];
 if(state.money<c.c||state.tiles[i])return;
 state.money-=c.c;
 state.tiles[i]={t:state.sel,d:Date.now()};
 save();draw();
}

function harvest(i){
 const x=state.tiles[i];
 const c=crops[x.t];
 if(Date.now()-x.d<c.t)return;
 state.money+=c.p;
 delete state.tiles[i];
 save();draw();
}

function unlock(){
 if(state.money<5)return;
 state.money-=5;
 state.unlocked++;
 save();draw();
}

/* CLÄ‚DIRI */
function openMarket(){
 info.innerHTML="ğŸª Market: vinzi automat recolta (+20%)";
}

function openStorage(){
 state.storage+=10;
 info.innerHTML="ğŸ“¦ Depozit extins: +10 capacitate";
 save();
}

function openHouse(){
 state.unlocked+=5;
 info.innerHTML="ğŸ  CasÄƒ: +5 tile-uri";
 save();
}

/* MISIUNI */
function claimMission(){
 const m=missions[state.mission];
 if(!m||!m.check())return;
 state.money+=m.reward;
 state.mission++;
 save();draw();
}

function draw(){
 money.textContent="ğŸ’° "+state.money;
 missionText.textContent=missions[state.mission]?.text || "Toate misiunile finalizate ğŸ‰";
 farm.innerHTML="";
 for(let i=0;i<100;i++){
  const d=document.createElement("div");
  d.className="tile";
  if(i>=state.unlocked){
   d.classList.add("locked");
   d.onclick=unlock;
  }else if(!state.tiles[i]){
   d.classList.add("free");
   d.onclick=()=>plant(i);
  }else{
   d.classList.add(state.tiles[i].t);
   d.onclick=()=>harvest(i);
  }
  farm.appendChild(d);
 }
}
</script>

</body>
</html>
