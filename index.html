<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8">
<title>Penguin Valley</title>

<!-- FIREBASE -->
<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

const firebaseConfig = {
 apiKey: "AIzaSyBSzq_-8WZ7xSqPqUd1nr_p4mNoHdFaZ3w",
 authDomain: "penguin-valley-9d490.firebaseapp.com",
 projectId: "penguin-valley-9d490",
 storageBucket: "penguin-valley-9d490.firebasestorage.app",
 messagingSenderId: "399240782858",
 appId: "1:399240782858:web:1d79355154b8be1ed3ebf3"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth();
const db = getFirestore();

window.login = async () => {
 const e=email.value,p=pass.value;
 try{
  await signInWithEmailAndPassword(auth,e,p);
 }catch{
  await createUserWithEmailAndPassword(auth,e,p);
 }
};

onAuthStateChanged(auth,async u=>{
 if(!u)return;
 loginBox.style.display="none";
 game.style.display="block";

 const ref=doc(db,"users",u.uid);
 const snap=await getDoc(ref);
 if(snap.exists()) Object.assign(state,snap.data());
 draw();
 setInterval(draw,1000);
});

window.save=async()=>{
 const u=auth.currentUser;
 if(u) await setDoc(doc(db,"users",u.uid),state);
};

</script>

<style>
body{margin:0;font-family:Arial;background:#cfefff;text-align:center}
#loginBox{margin-top:100px}
input,button{padding:8px;margin:5px}

#game{display:none}
#farm{
 display:grid;
 grid-template-columns:repeat(10,70px);
 gap:6px;
 justify-content:center;
 margin:20px auto;
}

.tile{
 width:70px;height:70px;
 background-size:cover;
 border-radius:14px;
 animation:pop .2s;
}

@keyframes pop{
 from{transform:scale(.8);opacity:0}
 to{transform:scale(1);opacity:1}
}

.free{background-image:url("assets/tiles/grass.png")}
.locked{background-image:url("assets/tiles/ice.png")}
.carrot{background-image:url("assets/tiles/carrot.png");animation:grow 1s infinite alternate}
.cabbage{background-image:url("assets/tiles/cabbage.png");animation:grow 1s infinite alternate}
.flower{background-image:url("assets/tiles/flower.png");animation:grow 1s infinite alternate}

@keyframes grow{
 from{filter:brightness(.9)}
 to{filter:brightness(1.1)}
}

#top{display:flex;justify-content:space-around;align-items:center}
</style>
</head>

<body>

<div id="loginBox">
 <h2>ğŸ§ Penguin Valley</h2>
 <input id="email" placeholder="email">
 <input id="pass" type="password" placeholder="parola">
 <br>
 <button onclick="login()">IntrÄƒ / CreeazÄƒ cont</button>
</div>

<div id="game">
 <div id="top">
  <div id="money">ğŸ’°</div>
  <div>
   <button onclick="sel('carrot')">ğŸ¥•</button>
   <button onclick="sel('cabbage')">ğŸ¥¬</button>
   <button onclick="sel('flower')">ğŸŒ¼</button>
  </div>
 </div>

 <img src="assets/penguin.png" width="80">

 <div id="farm"></div>
</div>

<script>
const crops={
 carrot:{t:60000,c:1,p:5},
 cabbage:{t:180000,c:3,p:15},
 flower:{t:360000,c:5,p:40}
};

let state={
 money:10,
 tiles:{},
 unlocked:20,
 sel:"carrot"
};

const farm=document.getElementById("farm");
const money=document.getElementById("money");

function sel(t){state.sel=t}

function plant(i){
 const c=crops[state.sel];
 if(state.money<c.c||state.tiles[i])return;
 state.money-=c.c;
 state.tiles[i]={t:state.sel,d:Date.now()};
 save();draw();
}

function harvest(i){
 const c=crops[state.tiles[i].t];
 if(Date.now()-state.tiles[i].d<c.t)return;
 state.money+=c.p;
 delete state.tiles[i];
 save();draw();
}

function unlock(){
 if(state.money<5)return;
 state.money-=5;
 state.unlocked++;
 save();draw();
}

function draw(){
 money.textContent="ğŸ’° "+state.money;
 farm.innerHTML="";
 for(let i=0;i<100;i++){
  const d=document.createElement("div");
  d.className="tile";
  if(i>=state.unlocked){
   d.classList.add("locked");
   d.onclick=unlock;
  }else if(!state.tiles[i]){
   d.classList.add("free");
   d.onclick=()=>plant(i);
  }else{
   d.classList.add(state.tiles[i].t);
   d.onclick=()=>harvest(i);
  }
  farm.appendChild(d);
 }
}
</script>

</body>
</html>
