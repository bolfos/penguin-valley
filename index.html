<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8">
<title>Penguin Valley MMO</title>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

const firebaseConfig = {
 apiKey: "AIzaSyBSzq_-8WZ7xSqPqUd1nr_p4mNoHdFaZ3w",
 authDomain: "penguin-valley-9d490.firebaseapp.com",
 projectId: "penguin-valley-9d490"
};

const app = initializeApp(firebaseConfig);
const auth = getAuth();
const db = getFirestore();

let uid=null;

window.login=async()=>{
 try{
  await signInWithEmailAndPassword(auth,email.value,pass.value);
 }catch{
  await createUserWithEmailAndPassword(auth,email.value,pass.value);
 }
};

onAuthStateChanged(auth,async u=>{
 if(!u) return;
 uid=u.uid;
 loginBox.style.display="none";
 game.style.display="block";

 const ref=doc(db,"users",uid);
 const snap=await getDoc(ref);
 if(snap.exists()) Object.assign(state,snap.data());
 draw(); drawQuest();
 setInterval(draw,1000);
});

async function save(){
 if(uid) await setDoc(doc(db,"users",uid),state);
}
</script>

<style>
body{margin:0;font-family:Arial;background:#bfe7ff}
button,input{padding:6px;margin:4px}

/* HARTA */
#world{
 width:2000px;
 height:2000px;
 background:linear-gradient(#e0f8ff,#b0e0ff);
 position:relative;
}

#viewport{
 width:100vw;
 height:100vh;
 overflow:scroll;
 border:4px solid #4aa3c4;
}

/* ZONA FERMA */
#farm{
 position:absolute;
 top:200px;
 left:200px;
 display:grid;
 grid-template-columns:repeat(8,70px);
 gap:6px;
 background:#ffffffcc;
 padding:10px;
 border-radius:16px;
}

.tile{
 width:70px;height:70px;
 border-radius:14px;
 display:flex;
 align-items:center;
 justify-content:center;
 font-size:32px;
 background:#9fda9f;
 cursor:pointer;
}

/* NPC */
.npc{
 position:absolute;
 top:200px;
 left:700px;
 font-size:48px;
 cursor:pointer;
}

/* UI */
#hud{
 position:fixed;
 top:5px;
 left:5px;
 background:white;
 padding:8px;
 border-radius:10px;
}

#dialog{
 position:fixed;
 bottom:10px;
 left:50%;
 transform:translateX(-50%);
 background:white;
 width:300px;
 padding:10px;
 border-radius:12px;
 display:none;
}
</style>
</head>

<body>

<div id="loginBox" style="text-align:center">
<h2>ğŸ§ Penguin Valley</h2>
<input id="email" placeholder="email">
<input id="pass" type="password">
<br>
<button onclick="login()">IntrÄƒ / CreeazÄƒ cont</button>
</div>

<div id="game" style="display:none">

<div id="hud"></div>

<div id="viewport">
 <div id="world">

  <!-- FERMA -->
  <div id="farm"></div>

  <!-- NPC -->
  <div class="npc" onclick="talk()">ğŸ§“ğŸ§</div>

 </div>
</div>

<div id="dialog"></div>

</div>

<script>
/* JOC */
const crops={
 carrot:{t:60000,c:1,p:5},
 cabbage:{t:180000,c:3,p:15},
 flower:{t:360000,c:5,p:40}
};

const npcDialog=[
 "Salut, mic fermier! ğŸŒ±",
 "AjutÄƒ-ne sÄƒ facem gheaÈ›a verde!",
 "PlanteazÄƒ 3 ğŸ¥• pentru Ã®nceput.",
 "Excelent! Acum eÈ™ti unul de-al nostru ğŸ§"
];

let state={
 money:20,
 gems:0,
 sel:"carrot",
 tiles:{},
 quest:0,
 dialog:0,
 stats:{harv:{carrot:0,cabbage:0,flower:0}}
};

const farm=document.getElementById("farm");
const hud=document.getElementById("hud");
const dialogBox=document.getElementById("dialog");

function sel(t){state.sel=t}

function draw(){
 hud.textContent=`ğŸ’° ${state.money} | ğŸ’ ${state.gems}`;
 farm.innerHTML="";
 for(let i=0;i<32;i++){
  const d=document.createElement("div");
  d.className="tile";
  if(!state.tiles[i]){
   d.textContent="ğŸ§";
   d.onclick=()=>plant(i);
  }else{
   d.textContent="ğŸŒ±";
   d.onclick=()=>harvest(i);
  }
  farm.appendChild(d);
 }
}

function plant(i){
 if(state.tiles[i]) return;
 const c=crops[state.sel];
 if(state.money<c.c) return;
 state.money-=c.c;
 state.tiles[i]={t:state.sel,d:Date.now()};
 save(); draw();
}

function harvest(i){
 const x=state.tiles[i];
 const c=crops[x.t];
 if(Date.now()-x.d<c.t) return;
 state.money+=c.p;
 state.stats.harv[x.t]++;
 delete state.tiles[i];
 save(); draw(); drawQuest();
}

/* NPC + QUEST */
function talk(){
 dialogBox.style.display="block";
 dialogBox.innerHTML=npcDialog[state.dialog] || "Ne vedem mai tÃ¢rziu!";
 state.dialog++;
 save();
}

function drawQuest(){
 if(state.stats.harv.carrot>=3 && state.quest===0){
  state.money+=20;
  state.gems+=2;
  state.quest=1;
  save();
 }
}
</script>

</body>
</html>
