<!DOCTYPE html>
<html lang="ro">
<head>
<meta charset="UTF-8">
<title>Penguin Farmer MMO</title>

<style>
*{box-sizing:border-box}
body{
 margin:0;font-family:Trebuchet MS,Arial;
 background:linear-gradient(#b3e5fc,#e0f7fa)
}
.hidden{display:none}
button{cursor:pointer;border:none}

#topbar{
 height:56px;background:#0d47a1;color:white;
 display:flex;align-items:center;justify-content:space-between;
 padding:0 16px;font-size:18px
}

#layout{display:flex;height:calc(100vh - 56px)}
#sidebar{
 width:220px;background:#bbdefb;padding:12px
}
.sidebtn{
 width:100%;margin-bottom:10px;padding:14px;
 border-radius:14px;background:#1976d2;
 color:white;font-size:16px
}
#content{flex:1;padding:16px;overflow:auto}

#farm{
 display:grid;
 grid-template-columns:repeat(6,90px);
 gap:12px;justify-content:center
}
.tile{
 width:90px;height:90px;border-radius:16px;
 display:flex;align-items:center;justify-content:center;
 font-size:26px;
 box-shadow:0 4px 0 rgba(0,0,0,.25)
}
.free{background:#a5d6a7}
.frozen{background:#cfd8dc}
.growing{background:#ffe082}
.ready{background:#81c784}

.panel{
 background:white;padding:16px;border-radius:16px;
 max-width:500px
}
.listItem{
 background:#f5f5f5;margin-bottom:8px;
 padding:10px;border-radius:12px;
 display:flex;justify-content:space-between
}

#login{
 position:fixed;inset:0;
 display:flex;align-items:center;justify-content:center;
 background:linear-gradient(#90caf9,#e3f2fd)
}
#loginBox{
 background:white;padding:20px;width:300px;
 border-radius:16px
}
</style>
</head>

<body>

<div id="login">
 <div id="loginBox">
  <h2>ğŸ§ Penguin Farmer</h2>
  <input id="email" placeholder="Email" style="width:100%;margin-bottom:10px;padding:8px">
  <input id="pass" type="password" placeholder="ParolÄƒ" style="width:100%;margin-bottom:10px;padding:8px">
  <button onclick="loginUser()" style="width:100%;padding:10px;background:#1976d2;color:white;border-radius:12px">
   IntrÄƒ / CreeazÄƒ cont
  </button>
 </div>
</div>

<div id="game" class="hidden">
<div id="topbar">
 <div>ğŸ§ Penguin Farmer MMO</div>
 <div id="stats"></div>
</div>

<div id="layout">
<div id="sidebar">
 <button class="sidebtn" onclick="show('farmView')">ğŸŒ¾ FermÄƒ</button>
 <button class="sidebtn" onclick="show('inventoryView')">ğŸ’ Inventar</button>
 <button class="sidebtn" onclick="show('buildView')">ğŸ­ ClÄƒdiri</button>
 <button class="sidebtn" onclick="show('marketView')">ğŸŒ Market MMO</button>
</div>

<div id="content">

<div id="farmView">
 <h2>Ferma</h2>
 <button onclick="selectCrop('carrot')">ğŸ¥•</button>
 <button onclick="selectCrop('cabbage')">ğŸ¥¬</button>
 <button onclick="selectCrop('flower')">ğŸŒ¼</button>
 <div id="farm"></div>
</div>

<div id="inventoryView" class="hidden panel">
 <h2>Inventar</h2>
 <div id="inventory"></div>
</div>

<div id="buildView" class="hidden panel">
 <h2>ClÄƒdiri</h2>
 <div id="buildings"></div>
</div>

<div id="marketView" class="hidden panel">
 <h2>Market Global</h2>
 <div id="market"></div>
</div>

</div>
</div>
</div>

<script type="module">
import { initializeApp } from "https://www.gstatic.com/firebasejs/12.8.0/firebase-app.js";
import { getAuth, signInWithEmailAndPassword, createUserWithEmailAndPassword, onAuthStateChanged }
 from "https://www.gstatic.com/firebasejs/12.8.0/firebase-auth.js";
import { getFirestore, doc, setDoc, getDoc, collection, addDoc, onSnapshot, deleteDoc }
 from "https://www.gstatic.com/firebasejs/12.8.0/firebase-firestore.js";

const firebaseConfig={
 apiKey:"AIzaSyBSzq_-8WZ7xSqPqUd1nr_p4mNoHdFaZ3w",
 authDomain:"penguin-valley-9d490.firebaseapp.com",
 projectId:"penguin-valley-9d490",
 storageBucket:"penguin-valley-9d490.firebasestorage.app",
 messagingSenderId:"399240782858",
 appId:"1:399240782858:web:1d79355154b8be1ed3ebf3"
};
const app=initializeApp(firebaseConfig);
const auth=getAuth();
const db=getFirestore();

/* GAME */
let uid,money=30,level=1;
let FREE=[7,8,13,14],tiles={},selectedCrop="carrot";
let inventory={carrot:0,cabbage:0,flower:0};
let buildings={factory:0,storage:0,market:0};

const crops={
 carrot:{emoji:"ğŸ¥•",time:8000,profit:5,cost:1},
 cabbage:{emoji:"ğŸ¥¬",time:15000,profit:15,cost:3},
 flower:{emoji:"ğŸŒ¼",time:25000,profit:40,cost:5}
};

/* AUTH */
window.loginUser=()=>{
 signInWithEmailAndPassword(auth,email.value,pass.value)
 .catch(()=>createUserWithEmailAndPassword(auth,email.value,pass.value));
};

onAuthStateChanged(auth,u=>{
 if(!u)return;
 uid=u.uid;
 login.classList.add("hidden");
 game.classList.remove("hidden");
 load().then(start);
});

/* SAVE */
async function save(){
 await setDoc(doc(db,"users",uid),{
  money,level,FREE,tiles,inventory,buildings
 });
}
async function load(){
 const d=await getDoc(doc(db,"users",uid));
 if(d.exists())Object.assign(window,d.data());
}

/* UI */
function update(){
 stats.textContent=`ğŸ’° ${money} | â­ ${level}`;
 drawInventory();drawBuildings();save();
}
window.show=id=>{
 ["farmView","inventoryView","buildView","marketView"]
 .forEach(v=>document.getElementById(v).classList.add("hidden"));
 document.getElementById(id).classList.remove("hidden");
};

/* FARM */
function drawFarm(){
 farm.innerHTML="";
 for(let i=0;i<36;i++){
  const d=document.createElement("div");d.className="tile";
  if(!FREE.includes(i)){
   d.classList.add("frozen");d.textContent="â„ï¸";
  }else if(!tiles[i]){
   d.classList.add("free");d.textContent="â•";
   d.onclick=()=>plant(i);
  }else{
   const c=crops[tiles[i].t];
   const r=c.time-(Date.now()-tiles[i].d);
   d.classList.add(r<=0?"ready":"growing");
   d.textContent=r<=0?c.emoji:"â³";
   if(r<=0)d.onclick=()=>harvest(i);
  }
  farm.appendChild(d);
 }
}
window.selectCrop=c=>selectedCrop=c;
function plant(i){
 const c=crops[selectedCrop];
 if(money<c.cost)return;
 money-=c.cost;tiles[i]={t:selectedCrop,d:Date.now()};
 update();drawFarm();
}
function harvest(i){
 inventory[tiles[i].t]++;
 delete tiles[i];
 update();drawFarm();
}

/* INVENTORY */
function drawInventory(){
 inventory.innerHTML="";
 for(const k in inventory){
  inventory.innerHTML+=`
   <div class="listItem">
    ${crops[k].emoji} x${inventory[k]}
    <button onclick="sellMMO('${k}')">Vinde</button>
   </div>`;
 }
}

/* MARKET MMO */
async function sellMMO(type){
 if(inventory[type]<=0)return;
 inventory[type]--;
 await addDoc(collection(db,"market"),{
  type,price:crops[type].profit*(1+buildings.factory*0.2),seller:uid
 });
 update();
}
onSnapshot(collection(db,"market"),snap=>{
 market.innerHTML="";
 snap.forEach(d=>{
  const m=d.data();
  market.innerHTML+=`
   <div class="listItem">
    ${crops[m.type].emoji} ${m.price} ğŸ’°
    <button onclick="buy('${d.id}',${m.price})">CumpÄƒrÄƒ</button>
   </div>`;
 });
});
window.buy=async(id,price)=>{
 if(money<price)return;
 money-=price;
 await deleteDoc(doc(db,"market",id));
 update();
};

/* BUILDINGS */
const buildData={
 factory:{emoji:"ğŸ­",cost:50},
 storage:{emoji:"ğŸšï¸",cost:40},
 market:{emoji:"ğŸª",cost:30}
};
function drawBuildings(){
 buildingsEl.innerHTML="";
 for(const k in buildData){
  buildingsEl.innerHTML+=`
   <div class="listItem">
    ${buildData[k].emoji} lvl ${buildings[k]}
    <button onclick="upgrade('${k}')">Upgrade (${buildData[k].cost})</button>
   </div>`;
 }
}
window.upgrade=k=>{
 const c=buildData[k].cost;
 if(money<c)return;
 money-=c;buildings[k]++;update();
};

/* START */
function start(){
 drawFarm();update();
 setInterval(drawFarm,1000);
}
</script>

</body>
</html>
